[Index](README.md)

Threads. Основы и определения
=============================

* [Atomic Action](#atomic-action)
* [Mutex Lock](#mutex-lock)
* [synchronized](#synchronized)
* [volatile](#volatile)
* [Race condition](#race-condition)


Atomic Action
-------------
Действие, которое либо производится целиком, либо не не производится вообще. Atomic действие не может быть остановлено посередине и разбито на отдельные части. Acomic код не может находиться в промежуточном состоянии. В Java к atomic операциям относятся:
* Чтение и запись ссылочных переменных и большинства примитивных типов (за исключением long и double).
* Чтение и запись всех переменнных объявленных как `volatile` (влючая long и double).

[tutorial](https://docs.oracle.com/javase/tutorial/essential/concurrency/atomic.html), [spec](https://docs.oracle.com/javase/specs/jls/se8/html/jls-17.html#jls-17.7)

Mutex Lock
----------
Предоставляется как средство синхронизации. Только один поток может захватить mutex: если два потока пытаются захватить mutex, то только один получает его. Другой поток вынужден ждать, пока первый поток освободит lock прежде чем захватить его и продолжить выполнение.

В Java каждый объект имеет ассоциированный lock. Если метод объявлен как `synchronized`, то выполняющий поток должен захватить lock ассоциированный с объектом прежде чем продолжать исполнение. После выполнения метода lock автоматически освобождается.

synchronized
------------
Если метод объявлен как `synchronized`, то потоку для того чтобы его выполнить нужно получить lock. Когда поток получает lock, он выполняет метод и затем освобождает lock. Не имеет значения как метод завершается, нормально или выбрасывает exception, в любом случае lock освобождается. У объекта есть только один lock, то есть если два потока стремятся выполнить synchronized методы одного и того же объекта, то только один поток сможет это сделать немедленно, второй поток вынужден ждать, пока первый поток отработает и освободит lock.

volatile
--------
Поток может хранить значения в локальной памяти (например в машинном регистре). В этом случае если один поток изменил значение переменной, то другой может не заметить этого. Это особенно актуально для циклов управляемых переменными.

Если же переменная объявлена как `volatile`, то каждый раз когда читается ее значение оно должно быть считано из основной памяти, и если значение сохраняется, то в основную память. Однако `volatile` может быть использовано только для atomic операций. Например операции инкремента и декремента не могут использоваться на `volatile` переменной потому что данные операции служат "syntactic sugar" для чтения, изменения и записи.

Race condition
--------------
Состояние гонки - ошибка проектирования многопоточной системы, при которой результат зависит от того, в какой последовательности выполняются части кода.


[Top](#threads-)
